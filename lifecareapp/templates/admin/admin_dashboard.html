{% extends "admin/base_admin.html" %}
{% load static %}

{% block content %}
<div class="container-fluid">
  <div class="row g-3">
    <div class="col-md-3">
      <div class="card stat-card p-3 text-center">
        <h6 class="mb-1 text-muted">Total Bookings</h6>
        <h3 class="stat-value" style="color:#00796b">{{ total_bookings }}</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stat-card p-3 text-center">
        <h6 class="mb-1 text-muted">Total Patients</h6>
        <h3 class="stat-value" style="color:#00796b">{{ total_patients }}</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stat-card p-3 text-center">
        <h6 class="mb-1 text-muted">Total Doctors</h6>
        <h3 class="stat-value" style="color:#00796b">{{ total_doctors }}</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stat-card p-3 text-center">
        <h6 class="mb-1 text-muted">Total Revenue (KES)</h6>
        <h3 class="stat-value" style="color:#00796b">KES {{ total_revenue|floatformat:2 }}</h3>
      </div>
    </div>
  </div>

  <div class="row mt-4 g-4">
    <div class="col-lg-7">
      <div class="card p-3">
        <h5 style="color:#00796b">Bookings (Last 30 days)</h5>
        <canvas id="bookingsChart" height="160"></canvas>
      </div>
    </div>

    <div class="col-lg-5">
      <div class="card p-3 mb-3">
        <h5 style="color:#00796b">Appointment Type Breakdown</h5>
        <canvas id="typesChart" height="160"></canvas>
      </div>

      <div class="card p-3">
        <h5 style="color:#00796b">Payments Summary</h5>
        <canvas id="paymentsChart" height="140"></canvas>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-12">
      <div class="card p-3">
        <h5 style="color:#00796b">Top Doctors (by bookings)</h5>
        <canvas id="topDocsChart" height="120"></canvas>
      </div>
    </div>
  </div>
</div>

{{ bookings_labels|json_script:"bookings-labels" }}
{{ bookings_counts|json_script:"bookings-counts" }}
{{ types_labels|json_script:"types-labels" }}
{{ types_counts|json_script:"types-counts" }}
{{ payments_labels|json_script:"payments-labels" }}
{{ payments_values|json_script:"payments-values" }}
{{ top_docs_labels|json_script:"topdocs-labels" }}
{{ top_docs_counts|json_script:"topdocs-counts" }}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const bookingsLabels = JSON.parse(document.getElementById('bookings-labels').textContent);
  const bookingsCounts = JSON.parse(document.getElementById('bookings-counts').textContent);

  const typesLabels = JSON.parse(document.getElementById('types-labels').textContent);
  const typesCounts = JSON.parse(document.getElementById('types-counts').textContent);

  const paymentsLabels = JSON.parse(document.getElementById('payments-labels').textContent);
  const paymentsValues = JSON.parse(document.getElementById('payments-values').textContent);

  const topDocsLabels = JSON.parse(document.getElementById('topdocs-labels').textContent);
  const topDocsCounts = JSON.parse(document.getElementById('topdocs-counts').textContent);

  const primary = '#00796b';
  const primaryLight = 'rgba(0,121,107,0.15)';

  new Chart(document.getElementById('bookingsChart').getContext('2d'), {
    type: 'line',
    data: {
      labels: bookingsLabels,
      datasets: [{
        label: 'Bookings',
        data: bookingsCounts,
        borderColor: primary,
        backgroundColor: primaryLight,
        fill: true,
        tension: 0.3,
        pointRadius: 3
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: { x: { ticks: { maxRotation: 0, minRotation: 0 } }, y: { beginAtZero: true } }
    }
  });

  new Chart(document.getElementById('typesChart').getContext('2d'), {
    type: 'doughnut',
    data: {
      labels: typesLabels,
      datasets: [{
        data: typesCounts,
        backgroundColor: ['#00796b','#43a047','#29b6f6','#ffb300','#9c27b0','#ef6c00','#8e24aa','#455a64'],
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'bottom' } }
    }
  });

  new Chart(document.getElementById('paymentsChart').getContext('2d'), {
    type: 'pie',
    data: {
      labels: paymentsLabels,
      datasets: [{
        data: paymentsValues,
        backgroundColor: ['#2e7d32','#c62828','#ffb300'],
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'bottom' } }
    }
  });

  new Chart(document.getElementById('topDocsChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: topDocsLabels,
      datasets: [{
        label: 'Bookings',
        data: topDocsCounts,
        backgroundColor: primary,
      }]
    },
    options: {
      indexAxis: 'y',
      responsive: true,
      plugins: { legend: { display: false } },
      scales: { x: { beginAtZero: true } }
    }
  });
</script>

<style>
  .card { border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.04); }
  .card h5 { margin-bottom: 12px; }
</style>
{% endblock %}
